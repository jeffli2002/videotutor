#!/bin/bash

echo "üîß OAuth Session Debugging Guide"
echo "=================================="
echo ""
echo "üß™ CURRENT ISSUE ANALYSIS:"
echo "‚Ä¢ Auth service initializes but finds no session"
echo "‚Ä¢ Duplicate initializations happening"
echo "‚Ä¢ INITIAL_SESSION event shows null session"
echo ""
echo "üìä DEBUGGING STEPS:"
echo ""
echo "Step 1: Check Browser Storage"
echo "‚Üí Open DevTools (F12) ‚Üí Application ‚Üí Storage"
echo "‚Üí Look for 'supabase.auth.token' in localStorage"
echo "‚Üí Look for session cookies"
echo ""
echo "Step 2: Test Google OAuth Flow"
echo "‚Üí Clear browser data (Ctrl+Shift+Del)"
echo "‚Üí Visit: http://localhost:5174"
echo "‚Üí Open Console (F12) ‚Üí Console"
echo "‚Üí Click 'Continue with Google'"
echo "‚Üí Watch console logs during redirect"
echo ""
echo "Step 3: Check Console Output"
echo "Expected logs:"
echo "‚úÖ 'Initializing auth service...'"
echo "‚úÖ 'Auth service initialized: {hasSession: true, hasUser: true}'"
echo "‚úÖ 'Auth state changed: SIGNED_IN [email]'"
echo "‚úÖ 'App: Auth state changed, user: [email]'"
echo ""
echo "‚ùå Current logs show:"
echo "‚Ä¢ 'Auth service initialized: {hasSession: false, hasUser: false}'"
echo "‚Ä¢ 'Auth state changed: INITIAL_SESSION undefined'"
echo ""
echo "üîç TROUBLESHOOTING:"
echo ""
echo "If session not persisting:"
echo "1. Check browser settings:"
echo "   ‚Ä¢ Third-party cookies enabled"
echo "   ‚Ä¢ LocalStorage enabled"
echo "   ‚Ä¢ Not in strict privacy mode"
echo ""
echo "2. Clear all auth data:"
echo "   ‚Ä¢ localStorage.clear()"
echo "   ‚Ä¢ sessionStorage.clear()"
echo "   ‚Ä¢ Clear cookies for localhost"
echo ""
echo "3. Test in different browser:"
echo "   ‚Ä¢ Try Chrome/Firefox/Edge"
echo "   ‚Ä¢ Try normal vs incognito mode"
echo ""
echo "4. Check Supabase configuration:"
echo "   ‚Ä¢ Redirect URLs match exactly"
echo "   ‚Ä¢ Site URL is correct"
echo "   ‚Ä¢ Google OAuth provider enabled"
echo ""
echo "üéØ NEXT ACTIONS:"
echo "1. Test Google OAuth with console open"
echo "2. Check if session data is stored after login"
echo "3. Verify redirect happens correctly"
echo "4. Confirm user data reaches the app"
echo ""
echo "üí° If still failing, try manual session check:"
echo "   In console: supabase.auth.getSession()"