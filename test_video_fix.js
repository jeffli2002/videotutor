// æµ‹è¯•è§†é¢‘ç”Ÿæˆä¿®å¤æ•ˆæœ
import { MathVideoAIService } from './src/services/mathVideoAI.js'

// æµ‹è¯•ç”¨ä¾‹1ï¼šåŒ…å«é‡å¤æ­¥éª¤çš„AIå“åº”
const testAIResponseWithDuplicates = `**è¯¦ç»†è§£é¢˜æ­¥éª¤**
1. **ç†è§£é¢˜ç›®** é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç†è§£é¢˜ç›®è¦æ±‚ï¼šè§£ä¸ç­‰å¼ 3x - 7 > 14
   è¿™æ˜¯ä¸€ä¸ªä¸€å…ƒä¸€æ¬¡ä¸ç­‰å¼ï¼Œéœ€è¦æ‰¾åˆ°xçš„èŒƒå›´

2. **åˆ—å‡ºä¸ç­‰å¼** æ ¹æ®é¢˜ç›®ï¼Œæˆ‘ä»¬æœ‰ä¸ç­‰å¼ï¼š3x - 7 > 14
   è¿™æ˜¯æ ‡å‡†çš„ä¸€å…ƒä¸€æ¬¡ä¸ç­‰å¼å½¢å¼

3. **ç§»é¡¹æ±‚è§£** å°†å¸¸æ•°é¡¹7ç§»åˆ°ç­‰å·å³è¾¹ï¼š
   3x - 7 > 14
   3x > 14 + 7
   3x > 21
   è§£é‡Šï¼šé€šè¿‡ç§»é¡¹ï¼Œæˆ‘ä»¬å°†æœªçŸ¥æ•°é¡¹å’Œå¸¸æ•°é¡¹åˆ†ç¦»

4. **è®¡ç®—å¾—å‡ºç»“æœ** é€šè¿‡é™¤ä»¥ç³»æ•°3æ¥æ±‚è§£xï¼š
   3x > 21
   x > 21 Ã· 3
   x > 7
   è§£é‡Šï¼šä¸ºäº†æ±‚è§£xï¼Œæˆ‘ä»¬éœ€è¦æ¶ˆé™¤xçš„ç³»æ•°3

5. **éªŒè¯ç­”æ¡ˆ** å°†x = 8ä»£å…¥åŸä¸ç­‰å¼éªŒè¯ï¼š
   3(8) - 7 = 24 - 7 = 17 > 14 âœ“
   éªŒè¯æ­£ç¡®

**æœ€ç»ˆç­”æ¡ˆ**
x > 7

**ç›¸å…³æ•°å­¦æ¦‚å¿µ**
ä¸€å…ƒä¸€æ¬¡ä¸ç­‰å¼ã€ç§»é¡¹ã€ç³»æ•°

**å¸¸è§é”™è¯¯æé†’**
æ³¨æ„ä¸ç­‰å·æ–¹å‘ï¼Œä¸è¦å¿˜è®°å˜å·
`

// æµ‹è¯•ç”¨ä¾‹2ï¼šé¡ºåºæ··ä¹±çš„æ­¥éª¤
const testAIResponseWithWrongOrder = `**è¯¦ç»†è§£é¢˜æ­¥éª¤**
3. **ç§»é¡¹æ±‚è§£** å°†å¸¸æ•°é¡¹7ç§»åˆ°ç­‰å·å³è¾¹ï¼š
   3x - 7 > 14
   3x > 14 + 7
   3x > 21

1. **ç†è§£é¢˜ç›®** é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç†è§£é¢˜ç›®è¦æ±‚ï¼šè§£ä¸ç­‰å¼ 3x - 7 > 14

5. **éªŒè¯ç­”æ¡ˆ** å°†x = 8ä»£å…¥åŸä¸ç­‰å¼éªŒè¯ï¼š
   3(8) - 7 = 24 - 7 = 17 > 14 âœ“

2. **åˆ—å‡ºä¸ç­‰å¼** æ ¹æ®é¢˜ç›®ï¼Œæˆ‘ä»¬æœ‰ä¸ç­‰å¼ï¼š3x - 7 > 14

4. **è®¡ç®—å¾—å‡ºç»“æœ** é€šè¿‡é™¤ä»¥ç³»æ•°3æ¥æ±‚è§£xï¼š
   3x > 21
   x > 21 Ã· 3
   x > 7

**æœ€ç»ˆç­”æ¡ˆ**
x > 7
`

// æµ‹è¯•ç”¨ä¾‹3ï¼šåŒ…å«é‡å¤å†…å®¹çš„æ­¥éª¤
const testAIResponseWithRepeatedContent = `**è¯¦ç»†è§£é¢˜æ­¥éª¤**
1. **ç†è§£é¢˜ç›®** é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç†è§£é¢˜ç›®è¦æ±‚ï¼šè§£ä¸ç­‰å¼ 3x - 7 > 14
   è¿™æ˜¯ä¸€ä¸ªä¸€å…ƒä¸€æ¬¡ä¸ç­‰å¼ï¼Œéœ€è¦æ‰¾åˆ°xçš„èŒƒå›´

2. **åˆ—å‡ºä¸ç­‰å¼** æ ¹æ®é¢˜ç›®ï¼Œæˆ‘ä»¬æœ‰ä¸ç­‰å¼ï¼š3x - 7 > 14
   è¿™æ˜¯æ ‡å‡†çš„ä¸€å…ƒä¸€æ¬¡ä¸ç­‰å¼å½¢å¼

3. **ç§»é¡¹æ±‚è§£** å°†å¸¸æ•°é¡¹7ç§»åˆ°ç­‰å·å³è¾¹ï¼š
   3x - 7 > 14
   3x > 14 + 7
   3x > 21

4. **ç§»é¡¹æ±‚è§£** å°†å¸¸æ•°é¡¹7ç§»åˆ°ç­‰å·å³è¾¹ï¼š
   3x - 7 > 14
   3x > 14 + 7
   3x > 21

5. **è®¡ç®—å¾—å‡ºç»“æœ** é€šè¿‡é™¤ä»¥ç³»æ•°3æ¥æ±‚è§£xï¼š
   3x > 21
   x > 21 Ã· 3
   x > 7

6. **è®¡ç®—å¾—å‡ºç»“æœ** é€šè¿‡é™¤ä»¥ç³»æ•°3æ¥æ±‚è§£xï¼š
   3x > 21
   x > 21 Ã· 3
   x > 7

**æœ€ç»ˆç­”æ¡ˆ**
x > 7
`

async function testVideoGenerationFix() {
  console.log('ğŸ§ª å¼€å§‹æµ‹è¯•è§†é¢‘ç”Ÿæˆä¿®å¤æ•ˆæœ...\n')
  
  const service = new MathVideoAIService()
  
  const testCases = [
    { name: 'é‡å¤æ­¥éª¤æµ‹è¯•', content: testAIResponseWithDuplicates },
    { name: 'é¡ºåºæ··ä¹±æµ‹è¯•', content: testAIResponseWithWrongOrder },
    { name: 'é‡å¤å†…å®¹æµ‹è¯•', content: testAIResponseWithRepeatedContent }
  ]
  
  for (const testCase of testCases) {
    console.log(`ğŸ“‹ ${testCase.name}`)
    console.log('=' * 50)
    
    try {
      // æµ‹è¯•é—®é¢˜ç±»å‹åˆ†æ
      console.log('ğŸ” æµ‹è¯•é—®é¢˜ç±»å‹åˆ†æ...')
      const analysis = service.analyzeQuestionType('è§£ä¸ç­‰å¼ 3x - 7 > 14')
      console.log('âœ… é—®é¢˜ç±»å‹åˆ†ææˆåŠŸ:', analysis)
      
      // æµ‹è¯•è§†é¢‘ç”Ÿæˆï¼ˆä¸å®é™…æ¸²æŸ“ï¼‰
      console.log('ğŸ¬ æµ‹è¯•è§†é¢‘ç”Ÿæˆæµç¨‹...')
      const videoResult = await service.generateMathVideo('è§£ä¸ç­‰å¼ 3x - 7 > 14', testCase.content, 'zh')
      console.log('âœ… è§†é¢‘ç”Ÿæˆæµç¨‹æµ‹è¯•æˆåŠŸ')
      console.log('ğŸ“Š ç»“æœ:', {
        type: videoResult.type,
        success: videoResult.success,
        duration: videoResult.totalDuration,
        animations: videoResult.animations?.length || 0
      })
      
      console.log('\n')
    } catch (error) {
      console.error(`âŒ ${testCase.name} å¤±è´¥:`, error.message)
      console.log('\n')
    }
  }
  
  console.log('ğŸ‰ æ‰€æœ‰æµ‹è¯•å®Œæˆï¼')
}

// è¿è¡Œæµ‹è¯•
testVideoGenerationFix().catch(console.error) 