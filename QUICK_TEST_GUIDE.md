# 🚀 快速测试指南

## 🔍 API连接失败诊断

### 第一步：确认服务器状态
1. 检查服务器是否正在运行：
   ```bash
   netstat -ano | findstr :8000
   ```
   应该看到类似: `TCP    0.0.0.0:8000    LISTENING`

2. 如果服务器未运行，启动它：
   ```bash
   python server.py
   ```

### 第二步：使用诊断工具
运行API连接测试脚本：
```bash
python test-api-connection.py
```

输入您的通义千问API密钥进行测试。

### 第三步：观察服务器日志
1. **保持服务器终端窗口可见**
2. 在浏览器中测试API连接时，观察服务器日志输出
3. 查找以下信息：
   - `📥 收到API请求` - 确认请求到达服务器
   - `🔑 API密钥` - 确认密钥正确接收
   - `🌐 正在调用通义千问API` - 确认开始调用外部API
   - `✅ API调用成功` 或 `❌ HTTP错误` - 查看结果

### 第四步：常见问题排查

#### 问题1：API密钥错误
**现象**: 看到HTTP 401错误
**解决**: 
- 检查API密钥是否以`sk-`开头
- 确认密钥正确复制，没有多余空格
- 验证阿里云账户是否有余额

#### 问题2：网络连接问题
**现象**: 看到网络错误或超时
**解决**:
- 检查网络连接
- 尝试直接访问：https://dashscope.aliyuncs.com
- 检查防火墙设置

#### 问题3：服务器不响应
**现象**: 浏览器显示"连接失败"
**解决**:
- 确认服务器在端口8000运行
- 检查是否有其他程序占用端口8000
- 重启服务器

#### 问题4：CORS错误
**现象**: 浏览器控制台显示CORS错误
**解决**:
- 确认使用本地服务器代理
- 检查服务器CORS设置
- 刷新浏览器页面

## 🔧 高级诊断

### 使用浏览器开发者工具
1. 按F12打开开发者工具
2. 切换到"网络"(Network)标签
3. 点击"测试连接"按钮
4. 查看网络请求详情：
   - 请求URL应该是 `http://localhost:8000/api/qwen`
   - 状态码应该是 200
   - 响应应该包含JSON数据

### 手动测试API调用
使用命令行测试：
```bash
curl -X POST http://localhost:8000/api/qwen \
  -H "Content-Type: application/json" \
  -d '{
    "api_key": "your-api-key-here",
    "messages": [{"role": "user", "content": "你好"}],
    "temperature": 0.1,
    "max_tokens": 100
  }'
```

## 📞 获取帮助

如果问题仍然存在，请提供以下信息：
1. 服务器日志输出
2. 浏览器开发者工具的网络请求截图
3. 使用的API密钥格式（隐藏敏感部分）
4. 操作系统和Python版本
5. 网络环境（是否使用代理等）

## 🎯 成功标志

测试成功时，您应该看到：
- ✅ 服务器日志显示"API调用成功"
- ✅ 浏览器显示"连接成功"
- ✅ 显示AI回复内容
- ✅ 显示token使用量和成本信息 